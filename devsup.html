
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Device Support &#8212; LBNL Embedded Ethernet Protocol (LEEP) 0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Python API Usage" href="usage.html" />
    <link rel="prev" title="Building Driver" href="building.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="device-support">
<h1>Device Support<a class="headerlink" href="#device-support" title="Permalink to this heading">¶</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h2>
<p>The FEED driver for EPICS does not require an explicit instance creation
step. Instead instances are created lazily on first usage. The Device IP
address is set, and may be changed, through a record with
<code class="docutils literal notranslate"><span class="pre">field(DTYP,</span> <span class="pre">&quot;FEED</span> <span class="pre">Set</span> <span class="pre">Address&quot;)</span></code>.</p>
<p>See <code class="docutils literal notranslate"><span class="pre">`feed.dbd</span></code> &lt;src/driver/feed.dbd&gt;`__ for the authoritative list of
Device Supports and IOCsh variables.</p>
</section>
<section id="ioc-shell-variables">
<h2>IOC Shell Variables<a class="headerlink" href="#ioc-shell-variables" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">feedNumInFlight</span></code> The number of concurrent requests which will
be made to any one device. Default 1.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">double</span> <span class="pre">feedTimeout</span></code> Timeout in seconds for an individual
request/reply exchange. Default 1.0</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">feedUDPHeaderSize</span></code> Size in byte of transport layer headers.
Used only in estimated bandwidth calculations. Default 42.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">int</span> <span class="pre">feedUDPPortNum</span></code> The default UDP port number. The default for
this default is <code class="docutils literal notranslate"><span class="pre">50006</span></code>.</p></li>
</ul>
</section>
<section id="inp-out-link-format">
<h2>INP / OUT link format<a class="headerlink" href="#inp-out-link-format" title="Permalink to this heading">¶</a></h2>
<p>All FEED device supports expect <code class="docutils literal notranslate"><span class="pre">INP</span></code> or <code class="docutils literal notranslate"><span class="pre">OUT</span></code> to be prefixed by
<code class="docutils literal notranslate"><span class="pre">&#64;</span></code>. aka. <code class="docutils literal notranslate"><span class="pre">INST_IO</span></code> followed by a space separated list of
<code class="docutils literal notranslate"><span class="pre">key=value</span></code> pairs. Only <code class="docutils literal notranslate"><span class="pre">name=</span></code> is required by all <code class="docutils literal notranslate"><span class="pre">DTYP</span></code>. See
below for which keys are understood by which <code class="docutils literal notranslate"><span class="pre">DTYP</span></code>.</p>
<p>Valid keys are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name=</span></code> The Instance name. Must be unique within an IOC process.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reg=</span></code> Register name. Must match key in Device JSON blob.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">offset=</span></code> Array registers only. Offset of first word accessed.
Default <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">step=</span></code> Array registers only. Number of words between accesses.
Default <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">scale=</span></code> Multiplier used for <code class="docutils literal notranslate"><span class="pre">aai</span></code>/<code class="docutils literal notranslate"><span class="pre">aao</span></code> with <code class="docutils literal notranslate"><span class="pre">FTVL</span></code> set to
<code class="docutils literal notranslate"><span class="pre">DOUBLE</span></code>. Default <code class="docutils literal notranslate"><span class="pre">1.0</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">wait=</span></code> Boolean. See below.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rbv=</span></code> Boolean. Input records only. <code class="docutils literal notranslate"><span class="pre">false</span></code> (default), use value
from previous read op. <code class="docutils literal notranslate"><span class="pre">true</span></code>, use value from previous write
(combine with <code class="docutils literal notranslate"><span class="pre">I/O</span> <span class="pre">Intr</span></code> for readback of setting)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">signal=</span></code> “signal” name in IOC JSON blob. Omitted when not set.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">meta=</span></code>. Boolean. Update record meta-data fields from Device JSON
when entering Running state. Default <code class="docutils literal notranslate"><span class="pre">false</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mask=</span></code>, <code class="docutils literal notranslate"><span class="pre">value=</span></code>, <code class="docutils literal notranslate"><span class="pre">retry=</span></code>. See Register Watch device support</p></li>
</ul>
</section>
<section id="tpro-debugging">
<h2>TPRO Debugging<a class="headerlink" href="#tpro-debugging" title="Permalink to this heading">¶</a></h2>
<p>FEED Device Supports where <code class="docutils literal notranslate"><span class="pre">TPRO</span> <span class="pre">&gt;</span> <span class="pre">1</span></code> will log extra information.</p>
</section>
<section id="drive-instance-control-status">
<h2>Drive Instance control/status<a class="headerlink" href="#drive-instance-control-status" title="Permalink to this heading">¶</a></h2>
<p>See <code class="docutils literal notranslate"><span class="pre">`feed_base.template</span></code> &lt;src/Db/feed_base.template&gt;`__ for the
recommended starting set of device control and status records.</p>
<section id="longout-feed-debug">
<h3>longout / FEED Debug<a class="headerlink" href="#longout-feed-debug" title="Permalink to this heading">¶</a></h3>
<p>Sets the instance debug printing mask.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">record</span><span class="p">(</span><span class="n">longout</span><span class="p">,</span> <span class="s2">&quot;$(PREF)DEBUG&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">field</span><span class="p">(</span><span class="n">DTYP</span><span class="p">,</span> <span class="s2">&quot;FEED Debug&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">OUT</span> <span class="p">,</span> <span class="s2">&quot;@name=$(NAME)&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="stringout-feed-force-error">
<h3>stringout / FEED Force Error<a class="headerlink" href="#stringout-feed-force-error" title="Permalink to this heading">¶</a></h3>
<p>Force the instance into the latching Error state. The driver will stop
all communication attempts until forced out of the error state by
(re)setting the IP address.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">record</span><span class="p">(</span><span class="n">stringout</span><span class="p">,</span> <span class="s2">&quot;$(PREF)HALT_&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">field</span><span class="p">(</span><span class="n">DTYP</span><span class="p">,</span> <span class="s2">&quot;FEED Force Error&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">OUT</span> <span class="p">,</span> <span class="s2">&quot;@name=$(NAME)&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="stringout-feed-set-address">
<h3>stringout / FEED Set Address<a class="headerlink" href="#stringout-feed-set-address" title="Permalink to this heading">¶</a></h3>
<p>Set the instance IP address and port.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">record</span><span class="p">(</span><span class="n">stringout</span><span class="p">,</span> <span class="s2">&quot;$(PREF)IPADDR&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">field</span><span class="p">(</span><span class="n">DTYP</span><span class="p">,</span> <span class="s2">&quot;FEED Set Address&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">OUT</span> <span class="p">,</span> <span class="s2">&quot;@name=$(NAME)&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="mbbi-feed-state">
<h3>mbbi / FEED State<a class="headerlink" href="#mbbi-feed-state" title="Permalink to this heading">¶</a></h3>
<p>Instance “connection” state.</p>
<ul class="simple">
<li><p>0, <code class="docutils literal notranslate"><span class="pre">Error</span></code> Latching error state. No communition attempted until
reset (by setting IP address)</p></li>
<li><p>1, <code class="docutils literal notranslate"><span class="pre">Idle</span></code>. Not latching. Not “connected” and no IP address set.</p></li>
<li><p>2, <code class="docutils literal notranslate"><span class="pre">Searching</span></code>. Not “connected”, periodically probing for device</p></li>
<li><p>3, <code class="docutils literal notranslate"><span class="pre">Inspecting</span></code>. Reading out and processing ROM image</p></li>
<li><p>4, <code class="docutils literal notranslate"><span class="pre">Running</span></code>. Normal operation</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">record</span><span class="p">(</span><span class="n">mbbi</span><span class="p">,</span> <span class="s2">&quot;$(PREF)STATUS&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">field</span><span class="p">(</span><span class="n">DTYP</span><span class="p">,</span> <span class="s2">&quot;FEED State&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">INP</span> <span class="p">,</span> <span class="s2">&quot;@name=$(NAME)&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="longin-feed-on-connect">
<h3>longin / FEED On Connect<a class="headerlink" href="#longin-feed-on-connect" title="Permalink to this heading">¶</a></h3>
<p>Processed on transition into Running state.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">record</span><span class="p">(</span><span class="n">longin</span><span class="p">,</span> <span class="s2">&quot;$(BASE)$(N)&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">field</span><span class="p">(</span><span class="n">DTYP</span><span class="p">,</span> <span class="s2">&quot;FEED On Connect&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">INP</span> <span class="p">,</span> <span class="s2">&quot;@name=$(NAME)&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">SCAN</span><span class="p">,</span> <span class="s2">&quot;I/O Intr&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="aai-feed-error">
<h3>aai / FEED Error<a class="headerlink" href="#aai-feed-error" title="Permalink to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">FTVL=CHAR</span></code> holds most recent error message string.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">record</span><span class="p">(</span><span class="n">aai</span><span class="p">,</span> <span class="s2">&quot;$(PREF)LAST_ERROR&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">field</span><span class="p">(</span><span class="n">DTYP</span><span class="p">,</span> <span class="s2">&quot;FEED Error&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">INP</span> <span class="p">,</span> <span class="s2">&quot;@name=$(NAME)&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">SCAN</span><span class="p">,</span> <span class="s2">&quot;I/O Intr&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">FTVL</span><span class="p">,</span> <span class="s2">&quot;CHAR&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">NELM</span><span class="p">,</span> <span class="s2">&quot;256&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="longin-feed-counter">
<h3>longin / FEED Counter<a class="headerlink" href="#longin-feed-counter" title="Permalink to this heading">¶</a></h3>
<p>Poll diagnostic counter by numeric index.</p>
<ul class="simple">
<li><p>0, UDP packets sent to device</p></li>
<li><p>1, UDP packets received from device</p></li>
<li><p>2, UDP packets ignored (eg. malformed)</p></li>
<li><p>3, Timeouts occurred</p></li>
<li><p>4, Internal driver errors occurred</p></li>
<li><p>5, Sequence number of next request</p></li>
<li><p>6, Bytes received from device, including estimate of transport
protocol overhead.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">record</span><span class="p">(</span><span class="n">longin</span><span class="p">,</span> <span class="s2">&quot;$(PREF)$(N)&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">field</span><span class="p">(</span><span class="n">DTYP</span><span class="p">,</span> <span class="s2">&quot;FEED Counter&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">INP</span> <span class="p">,</span> <span class="s2">&quot;@name=$(NAME) offset=$(INDEX)&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="ai-feed-rtt">
<h3>ai / FEED RTT<a class="headerlink" href="#ai-feed-rtt" title="Permalink to this heading">¶</a></h3>
<p>Average round trip time between last 100 requests and replies.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">record</span><span class="p">(</span><span class="n">ai</span><span class="p">,</span> <span class="s2">&quot;$(PREF)RTT&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">field</span><span class="p">(</span><span class="n">DTYP</span><span class="p">,</span> <span class="s2">&quot;FEED RTT&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">INP</span> <span class="p">,</span> <span class="s2">&quot;@name=$(NAME)&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="aai-feed-jblob">
<h3>aai / FEED JBlob<a class="headerlink" href="#aai-feed-jblob" title="Permalink to this heading">¶</a></h3>
<p>zlib compressed JSON blob. “offset” 0 is the IOC description blob,
“offset” 1 is a copy of most recent Device blob.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">record</span><span class="p">(</span><span class="n">aai</span><span class="p">,</span> <span class="s2">&quot;$(PREF)JINFO&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">field</span><span class="p">(</span><span class="n">DTYP</span><span class="p">,</span> <span class="s2">&quot;FEED JBlob&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">INP</span> <span class="p">,</span> <span class="s2">&quot;@name=$(NAME) offset=0&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">SCAN</span><span class="p">,</span> <span class="s2">&quot;I/O Intr&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">FTVL</span><span class="p">,</span> <span class="s2">&quot;CHAR&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">NELM</span><span class="p">,</span> <span class="s2">&quot;16000&quot;</span><span class="p">)</span>
<span class="p">}</span>
<span class="n">record</span><span class="p">(</span><span class="n">aai</span><span class="p">,</span> <span class="s2">&quot;$(PREF)JSON&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">field</span><span class="p">(</span><span class="n">DTYP</span><span class="p">,</span> <span class="s2">&quot;FEED JBlob&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">INP</span> <span class="p">,</span> <span class="s2">&quot;@name=$(NAME) offset=1&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">SCAN</span><span class="p">,</span> <span class="s2">&quot;I/O Intr&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">FTVL</span><span class="p">,</span> <span class="s2">&quot;CHAR&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">NELM</span><span class="p">,</span> <span class="s2">&quot;16000&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="aai-feed-rom-info">
<h3>aai / FEED ROM Info<a class="headerlink" href="#aai-feed-rom-info" title="Permalink to this heading">¶</a></h3>
<p>Information by numeric index from Device ROM image.</p>
<ul class="simple">
<li><p>0, Application description string</p></li>
<li><p>2, Application Git revision hash</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">record</span><span class="p">(</span><span class="n">aai</span><span class="p">,</span> <span class="s2">&quot;$(PREF)$(NAME)&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">field</span><span class="p">(</span><span class="n">DTYP</span><span class="p">,</span> <span class="s2">&quot;FEED ROM Info&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">INP</span> <span class="p">,</span> <span class="s2">&quot;@name=$(NAME) offset=$(INDEX)&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">SCAN</span><span class="p">,</span> <span class="s2">&quot;I/O Intr&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">FTVL</span><span class="p">,</span> <span class="s2">&quot;CHAR&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">NELM</span><span class="p">,</span> <span class="s2">&quot;256&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="register-access">
<h2>Register access<a class="headerlink" href="#register-access" title="Permalink to this heading">¶</a></h2>
<p>Each record with a register Read or Write device support will enqueue a
request for a remote read or write operation on all addresses of the
named (by string) register.</p>
<p>Internally, the FEED driver will manage batching of pending requests
into UDP packets.</p>
<section id="feed-register-read">
<h3>FEED Register Read<a class="headerlink" href="#feed-register-read" title="Permalink to this heading">¶</a></h3>
<p>Supported for record types: longin, ai (RVAL), mbbi (RVAL), and aai.</p>
<p>Asynchronous device support when <code class="docutils literal notranslate"><span class="pre">wait=true</span></code> (default), initiate
register read. Synchronous when <code class="docutils literal notranslate"><span class="pre">wait=false</span></code>, read from local cache.</p>
<p>On scan, request read of the named register. Processing completes on
success, with updated VAL/RVAL, or an <code class="docutils literal notranslate"><span class="pre">INVALID</span></code> alarm on timeout.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">SCAN</span></code> set to <code class="docutils literal notranslate"><span class="pre">I/O</span> <span class="pre">Intr</span></code>, record will be processed when after
the named register has been read for any reason (eg. some other record)
using the value returned by that operation. Or an <code class="docutils literal notranslate"><span class="pre">INVALID</span></code> alarm on
timeout.</p>
<p>For <code class="docutils literal notranslate"><span class="pre">aai</span></code> record type. Supported <code class="docutils literal notranslate"><span class="pre">FTVL</span></code> are: <code class="docutils literal notranslate"><span class="pre">CHAR</span></code>, <code class="docutils literal notranslate"><span class="pre">UCHAR</span></code>,
<code class="docutils literal notranslate"><span class="pre">SHORT</span></code>, <code class="docutils literal notranslate"><span class="pre">USHORT</span></code>, <code class="docutils literal notranslate"><span class="pre">LONG</span></code>, <code class="docutils literal notranslate"><span class="pre">ULONG</span></code>, or <code class="docutils literal notranslate"><span class="pre">DOUBLE</span></code>. Link options
<code class="docutils literal notranslate"><span class="pre">offset=</span></code> and/or <code class="docutils literal notranslate"><span class="pre">step=</span></code> allow slicing of array registers. When
<code class="docutils literal notranslate"><span class="pre">FTVL</span></code> is <code class="docutils literal notranslate"><span class="pre">DOUBLE</span></code>, link option <code class="docutils literal notranslate"><span class="pre">scale=</span></code> multiplier is used.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># poll the required HELLO register</span>
<span class="n">record</span><span class="p">(</span><span class="n">longin</span><span class="p">,</span> <span class="s2">&quot;$(PREF)HELLO-I&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">field</span><span class="p">(</span><span class="n">DTYP</span><span class="p">,</span> <span class="s2">&quot;FEED Register Read&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">INP</span> <span class="p">,</span> <span class="s2">&quot;@name=$(NAME) reg=HELLO&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">SCAN</span><span class="p">,</span> <span class="s2">&quot;2 second&quot;</span><span class="p">)</span>
<span class="p">}</span>
<span class="n">record</span><span class="p">(</span><span class="n">aai</span><span class="p">,</span> <span class="s2">&quot;$(PREF)FW_ROM&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">field</span><span class="p">(</span><span class="n">DTYP</span><span class="p">,</span> <span class="s2">&quot;FEED Register Read&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">INP</span> <span class="p">,</span> <span class="s2">&quot;@name=$(NAME) reg=ROM&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">SCAN</span><span class="p">,</span> <span class="s2">&quot;I/O Intr&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">FTVL</span><span class="p">,</span> <span class="s2">&quot;LONG&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">NELM</span><span class="p">,</span> <span class="s2">&quot;2048&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="feed-register-write">
<h3>FEED Register Write<a class="headerlink" href="#feed-register-write" title="Permalink to this heading">¶</a></h3>
<p>Supported for record types: longout, ao (RVAL), mbbo (RVAL), and aao.</p>
<p>Asynchronous device support when <code class="docutils literal notranslate"><span class="pre">wait=true</span></code> (default), wait for
register write operation to complete. Synchronous when <code class="docutils literal notranslate"><span class="pre">wait=false</span></code>,
initiate write and immediately continue.</p>
<p>Asynchronous device support when <code class="docutils literal notranslate"><span class="pre">wait=true</span></code> (default). Synchronous
when <code class="docutils literal notranslate"><span class="pre">wait=false</span></code>.</p>
<p>On scan, request write of the named register. Processing completes on
success, with updated VAL/RVAL, or an <code class="docutils literal notranslate"><span class="pre">INVALID</span></code> alarm on timeout.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">FTVL</span></code> is <code class="docutils literal notranslate"><span class="pre">DOUBLE</span></code>, link option <code class="docutils literal notranslate"><span class="pre">scale=</span></code> multiplier is used.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">record</span><span class="p">(</span><span class="n">longout</span><span class="p">,</span> <span class="s2">&quot;$(BASE)$(N)&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">field</span><span class="p">(</span><span class="n">DTYP</span><span class="p">,</span> <span class="s2">&quot;FEED Register Write&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">OUT</span> <span class="p">,</span> <span class="s2">&quot;@name=$(NAME) reg=$(REG)&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="bo-feed-register-watch">
<h3>bo / FEED Register Watch<a class="headerlink" href="#bo-feed-register-watch" title="Permalink to this heading">¶</a></h3>
<p>Special repeated read operation to poll for bit field register.</p>
<p>Once initiated, polls until success or device timeout.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># wait for value &amp; $(RDY_MASK) == $(RDY_MASK) for reg $(RDY_REG)</span>
<span class="n">record</span><span class="p">(</span><span class="n">bo</span><span class="p">,</span> <span class="s2">&quot;$(BASE)$(N)&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">field</span><span class="p">(</span><span class="n">DTYP</span><span class="p">,</span> <span class="s2">&quot;FEED Register Watch&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">OUT</span> <span class="p">,</span> <span class="s2">&quot;@name=$(NAME) retry=$(RETRY=0.1) reg=$(RDY_REG) mask=$(RDY_MASK) value=$(RDY_MASK)&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="feed-sync">
<h3>FEED Sync<a class="headerlink" href="#feed-sync" title="Permalink to this heading">¶</a></h3>
<p>The special DTYP=”FEED Sync” support exists to allow sequencing during (re)connection.
This asynchronous record will complete processing after every in-progress register read/write
can completed (or timed out).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">record</span><span class="p">(</span><span class="n">longin</span><span class="p">,</span> <span class="s2">&quot;$(BASE)Init3_&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">field</span><span class="p">(</span><span class="n">DTYP</span><span class="p">,</span> <span class="s2">&quot;FEED Sync&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">INP</span> <span class="p">,</span> <span class="s2">&quot;@name=$(NAME)&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="signals">
<h2>Signals<a class="headerlink" href="#signals" title="Permalink to this heading">¶</a></h2>
<p>The Signals device supports allow some parameters specified in
an INP/OUT link to be changed after initialization via
a different record.</p>
<p>The association between two records is made with the ‘signal=’ parameter.
Which is a IOC wide unique identifier (unique to one of the  Register Read/Write DTYPs).</p>
<p>Signal names may be selected arbitrarily.
It is suggeste to use a combination of record name prefix,
device name, and/or register name.</p>
<p>In this example, the “$(P)Off-SP” controls, and overrides, the offset=
paramter for “$(P)-I”.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">record</span><span class="p">(</span><span class="n">aai</span><span class="p">,</span> <span class="s2">&quot;$(P)-I&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">field</span><span class="p">(</span><span class="n">DTYP</span><span class="p">,</span> <span class="s2">&quot;FEED Register Read&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">INP</span> <span class="p">,</span> <span class="s2">&quot;@name=&lt;devicename&gt; reg=&lt;regname&gt; signal=$(P):&lt;regname&gt;&quot;</span><span class="p">)</span>
    <span class="o">...</span>
<span class="p">}</span>
<span class="n">register</span><span class="p">(</span><span class="n">longout</span><span class="p">,</span> <span class="s2">&quot;$(P)Off-SP&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">field</span><span class="p">(</span><span class="n">DTYP</span><span class="p">,</span> <span class="s2">&quot;FEED Signal Offset&quot;</span><span class="p">)</span>
    <span class="n">field</span><span class="p">(</span><span class="n">OUT</span> <span class="p">,</span> <span class="s2">&quot;@signal=$(P):&lt;regname&gt;&quot;</span><span class="p">)</span>
    <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Currently only the offset, step=, and scale= parameters may be override via the Signals mechanism.</p>
</section>
<section id="longout-feed-hack-lp-1745039">
<h2>longout / FEED Hack lp:1745039<a class="headerlink" href="#longout-feed-hack-lp-1745039" title="Permalink to this heading">¶</a></h2>
<p>Workaround for bug in epics-base &lt; 7.0.2 when chaining asynchronous
records. A no-op when built with &gt;= 7.0.2</p>
<p><a class="reference external" href="https://bugs.launchpad.net/epics-base/+bug/1745039">https://bugs.launchpad.net/epics-base/+bug/1745039</a></p>
<section id="dbior">
<h3>dbior<a class="headerlink" href="#dbior" title="Permalink to this heading">¶</a></h3>
<p>The ‘dbior’ IOC shell command will give infomation about all FEED Devices.</p>
<section id="simulator-logic">
<h4>Simulator Logic<a class="headerlink" href="#simulator-logic" title="Permalink to this heading">¶</a></h4>
<p>The simulator can be made to simulator some of the register handling logic
of some devices.  Currently only the RFS waveform acquisition logic is modeled.</p>
<p>The argument -L &lt;name&gt; is used to enable logic handling.
This will fail if the loaded register description doesn’t
include all necessary registers.</p>
<p>eg.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="nb">bin</span><span class="o">/</span><span class="n">linux</span><span class="o">-</span><span class="n">x86_64</span><span class="o">/</span><span class="n">feedsim</span> <span class="o">-</span><span class="n">L</span> <span class="n">rfs</span> <span class="n">tests</span><span class="o">/</span><span class="n">jblob</span><span class="o">.</span><span class="n">json</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="snapshot-and-simulate">
<h2>Snapshot and Simulate<a class="headerlink" href="#snapshot-and-simulate" title="Permalink to this heading">¶</a></h2>
<p>To snapshot a actual device for simulation, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">leep</span><span class="o">.</span><span class="n">cli</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="n">json</span> <span class="o">&gt;</span> <span class="n">capture</span><span class="o">.</span><span class="n">json</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">leep</span><span class="o">.</span><span class="n">cli</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="n">dump</span> <span class="o">-</span><span class="n">Z</span> <span class="o">&gt;</span> <span class="n">capture</span><span class="o">.</span><span class="n">initial</span>
</pre></div>
</div>
<p>This snapshot can then be simulated later:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="nb">bin</span><span class="o">/</span><span class="n">linux</span><span class="o">-</span><span class="n">x86_64</span><span class="o">/</span><span class="n">feedsim</span> <span class="n">capture</span><span class="o">.</span><span class="n">json</span> <span class="n">capture</span><span class="o">.</span><span class="n">initial</span>
</pre></div>
</div>
</section>
<section id="protocol">
<h2>Protocol<a class="headerlink" href="#protocol" title="Permalink to this heading">¶</a></h2>
<p>The network protocol implemented by FEED is described in [proto.md](proto.md).</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">LBNL Embedded Ethernet Protocol (LEEP)</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="building.html">Building Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="building.html#tools">Tools</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Device Support</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ioc-shell-variables">IOC Shell Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="#inp-out-link-format">INP / OUT link format</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tpro-debugging">TPRO Debugging</a></li>
<li class="toctree-l2"><a class="reference internal" href="#drive-instance-control-status">Drive Instance control/status</a></li>
<li class="toctree-l2"><a class="reference internal" href="#register-access">Register access</a></li>
<li class="toctree-l2"><a class="reference internal" href="#signals">Signals</a></li>
<li class="toctree-l2"><a class="reference internal" href="#longout-feed-hack-lp-1745039">longout / FEED Hack lp:1745039</a></li>
<li class="toctree-l2"><a class="reference internal" href="#snapshot-and-simulate">Snapshot and Simulate</a></li>
<li class="toctree-l2"><a class="reference internal" href="#protocol">Protocol</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Python API Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Python API</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="building.html" title="previous chapter">Building Driver</a></li>
      <li>Next: <a href="usage.html" title="next chapter">Python API Usage</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Michael Davidsaver.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.3.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/devsup.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>